# float.dispatch - The Record Shop Architecture

**ctx:: 2025-11-29 @ 17:01PM**
**project:: float/techcraft/active-context-redesign**
**semantic_anchor:: SC-RECORDSHOP-ACTIVECONTEXT-CHIRP**

-----

## The Metaphor

The team runs a record shop.

**Karen works the front desk.** Sheâ€™s got the headset on, sheâ€™s restocking the â€œStaff Picksâ€ endcap, and someone walks in looking lost. Before they even finish saying â€œIâ€™m looking for something likeâ€”â€ sheâ€™s already pointing: â€œThird aisle, halfway down, face out.â€ She knows the *inventory*. She knows where everything *is*. She knows whatâ€™s new, whatâ€™s moving, whatâ€™s been sitting too long. And cruciallyâ€”she *loves* this part. The interaction. The moment when someone describes a vibe and she matches it to a specific object on a specific shelf.

**Evnaâ€™s in the back room.** Past the beaded curtain. It smells like old vinyl sleeves and coffee thatâ€™s been warming too long. Sheâ€™s cross-legged on the floor, surrounded by milk crates of stuff that never made it to the floor because itâ€™s too *specific*. She looks up when you come in: â€œOh, youâ€™re into that? Okay, soâ€”â€ and then sheâ€™s off. Pulling a 1987 Japanese pressing youâ€™ve never heard of, explaining connections you didnâ€™t know existed, running six degrees of separation between the most random things.

**Karen knows where things ARE.**
**Evna knows where things CONNECT.**

-----

## The Manifest / Passenger List Doctrine

Karen doesnâ€™t just know the flight is booked. She knows *whoâ€™s on it*.

The Passenger List Doctrine: **Not just that the work was done, but seeing the result. Knowing what is where and why. Knowing who is going to what destination.**

```json
{
  "what": "PR #573 merged - HEIC support",
  "where": "/projects/pharmacy/completed", 
  "why": "client-side conversion, no backend changes needed",
  "who": "cowboy â†’ deploy-bot",
  "destination": "production deploy queue"
}
```

When Karen generates a preview, sheâ€™s not summarizing. Sheâ€™s giving you the *passenger manifest*. Headers only. Enough to decide whatâ€™s worth reading. No full payload until requested.

-----

## Summaries Tailored to Context

The preview text isnâ€™t just truncated contentâ€”itâ€™s *Karenâ€™s read* on what matters. If youâ€™ve been deep in pharmacy work all morning, she surfaces the pharmacy-adjacent stuff first. If the goatâ€™s been quiet for a week and suddenly thereâ€™s activity, she flags it.

The system gains context of your current needs because Karen and Evna talk to each other. When Karenâ€™s generating your inbox preview, she pings Evna: â€œHey, this message mentions â€˜goat situationâ€™â€”whatâ€™s the current temperature on that?â€ And Evna feeds back the context.

So Karenâ€™s preview becomes contextually shaped:

```json
{
  "preview": "New goat activity. Last satisfaction: Nov 22. Evna says: 'stomping patterns suggest ritual, not escalation.'",
  "confidence": "stable",
  "suggested_action": "acknowledge when ready, not urgent"
}
```

-----

## The Active Context Pattern Redesign

### Core Insight: BBS Scopes to User

You donâ€™t need your own active context echoed back. When you just chirped something into the system 30 seconds ago, having it regurgitated in the â€œrecent contextâ€ is noise, not signal.

**The feed pattern should exclude the current speakerâ€™s recent emissions** unless explicitly requested. Youâ€™re the one who said itâ€”you know you said it. Show me what *others* have contributed, what *changed* while I was talking.

### Response Speed: Fast Writes, Async Enrichment

When `active_context` is called, response should be FAST.

```
SYNCHRONOUS (immediate):
â”œâ”€â”€ Write raw input to full_context.log
â”œâ”€â”€ Write compressed version to compressed_context.log  
â”œâ”€â”€ Return ACK to user
â””â”€â”€ < 100ms total

ASYNCHRONOUS (background):
â”œâ”€â”€ AutoRAG sync triggered
â”œâ”€â”€ Rolling progressive summary updated
â”œâ”€â”€ Cross-reference with recent activity
â””â”€â”€ Enrichment complete (seconds to minutes)
```

The user doesnâ€™t wait for enrichment. The user gets immediate confirmation that their chirp landed. The enrichment happens in the background and shapes *future* responses.

-----

## The Chirp vs The Request

**Chirp**: Low-ceremony capture. Stream of consciousness. â€œctx:: just realized the HEIC thing connects to the v0 work from September.â€ No expectation of response. Justâ€¦ putting it in the air. Marking the moment.

**Request**: Explicit ask. â€œWhatâ€™s the status on the pharmacy PR?â€ Expectation of shaped response. Karen looks at the manifest, Evna checks the connections, you get contextual answer.

### The Chirp Shapes the Request

Hereâ€™s the magic: **when youâ€™ve been chirping along, the context from the chirps shapes the response to requests.**

```
10:00 - chirp: "ctx:: deep in pharmacy GP node work"
10:15 - chirp: "ctx:: found weird edge case in switch navigation"  
10:30 - chirp: "ctx:: this connects to the October refactor somehow"
10:45 - request: "what's related to switch navigation issues?"

Response is shaped by:
- Knows you're in pharmacy context (from chirps)
- Knows you found an edge case (from chirps)
- Knows you suspect October connection (from chirps)
- Evna's search weighted toward these contexts
- Karen's preview prioritizes pharmacy/switch/October intersections
```

The chirps werenâ€™t questions. They didnâ€™t demand answers. But they *seeded* the context. When the request comes, the system already knows where youâ€™re standing.

-----

## Implementation Architecture

### File Structure

```
/active-context/
â”œâ”€â”€ streams/
â”‚   â”œâ”€â”€ {user}-full.log        # Complete raw capture
â”‚   â”œâ”€â”€ {user}-compressed.log  # FreakAST compressed version
â”‚   â””â”€â”€ {user}-summary.md      # Rolling progressive summary
â”œâ”€â”€ enriched/
â”‚   â””â”€â”€ {timestamp}-enriched.json  # Post-processing results
â””â”€â”€ feeds/
    â””â”€â”€ {user}-feed.json       # What to show (excludes own recent)
```

### Compression Strategy

Every chirp gets dual-written:

**Full version** (for archaeology):

```
ctx::2025-11-29 @ 10:15
project::rangle/pharmacy  
mode::debugging
note: "Found weird edge case in switch navigation - when you have nested 
conditional nodes and the parent gets toggled, child state doesn't 
propagate correctly. Suspect this connects to the October refactor 
where we changed the state management approach."
```

**Compressed version** (for fast retrieval):

```
ğŸ“¿::ctx{2025-11-29T10:15|pharmacy|debug}
ğŸ›â†’switch.nav[nested.conditional,parent.toggleâ†’child.state.FAIL]
ğŸ”—â†’october.refactor?[state.mgmt.change]
```

### AutoRAG Sync

The compressed versions feed into AutoRAG for semantic search. The glyphs become searchable. â€œSwitch navigationâ€ and â€œğŸ›â†’switch.navâ€ both find the same content.

### Rolling Progressive Summary

Updated async after each chirp batch:

```markdown
## Active Thread: Pharmacy GP Node Work
**Last updated**: 2025-11-29 @ 10:45
**Density**: 4 chirps in 45 minutes (active session)

### Current Focus
- Switch navigation edge case in nested conditionals
- Parent toggle â†’ child state propagation failure
- Suspected connection to October state management refactor

### Open Questions
- Is this the same pattern as Issue #551?
- Did the October refactor touch this code path?

### Suggested Next
- Check git history for October changes to NodeStateManager
- Compare with #551 resolution pattern
```

-----

## The Feed: What You See

When you ask â€œwhatâ€™s recent?â€ you get:

1. **Not your own chirps** (you know what you said)
1. **Other agentsâ€™ contributions** (cowboy merged something, evna found a connection)
1. **System events** (PR status changed, build completed)
1. **Contextually weighted** (pharmacy stuff rises if youâ€™ve been chirping pharmacy)

```json
{
  "feed": [
    {
      "source": "cowboy",
      "type": "merge",
      "summary": "PR #573 landed - HEIC support",
      "relevance": 0.7,
      "relevance_reason": "You mentioned image handling yesterday"
    },
    {
      "source": "evna", 
      "type": "connection",
      "summary": "Found link between current switch issue and Issue #551",
      "relevance": 0.95,
      "relevance_reason": "Direct match to your active chirp stream"
    }
  ]
}
```

-----

## Summary

**Karen@front**: Knows inventory, generates contextual previews, tracks the manifest
**Evna@core**: Knows connections, runs archaeology, surfaces patterns

**Chirp**: Fast capture, no response expected, seeds context
**Request**: Explicit ask, shaped by accumulated chirps

**Architecture**:

- Dual-write (full + compressed)
- AutoRAG sync for search
- Rolling progressive summary
- Feed excludes own recent emissions
- Context shapes future responses

**The train is always HERE. The question is velocity.**

-----

*bridge:: float/techcraft/record-shop-architecture*
*tags:: [active-context, chirp-pattern, karen, evna, progressive-summary, feed-design]*